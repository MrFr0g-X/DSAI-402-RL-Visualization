<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RL Learning Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>RL Playground</h1>
            <p class="subtitle">train agents • visualize policies • experiment with algorithms</p>
        </header>

        <div class="main-content">
            <!-- Left Panel - Controls -->
            <div class="control-panel">
                <div class="section">
                    <h3>Environment</h3>
                    <select id="env-select">
                        <option value="gridworld">GridWorld</option>
                        <option value="frozenlake">FrozenLake</option>
                        <option value="cliffwalking">CliffWalking</option>
                        <option value="mountaincar">MountainCar</option>
                        <option value="cartpole">CartPole</option>
                    </select>
                    <button id="init-env-btn" class="btn">Initialize</button>
                    <p class="tooltip" id="env-tooltip">Select an environment to start</p>
                </div>

                <div class="section">
                    <h3>Algorithm</h3>
                    <select id="algo-select">
                        <option value="policy_iteration">Policy Iteration</option>
                        <option value="value_iteration">Value Iteration</option>
                        <option value="monte_carlo">Monte Carlo</option>
                        <option value="td">TD(0)</option>
                        <option value="n_step_td">N-step TD</option>
                        <option value="sarsa">SARSA</option>
                        <option value="q_learning">Q-Learning</option>
                    </select>
                    <p class="tooltip" id="algo-tooltip">Select learning algorithm</p>
                </div>

                <div class="section">
                    <h3>Parameters</h3>

                    <div class="param-row">
                        <label for="gamma">Gamma (discount): <span id="gamma-val">0.99</span></label>
                        <input type="range" id="gamma" min="0" max="1" step="0.01" value="0.99">
                        <span class="param-tooltip">How much to value future rewards</span>
                    </div>

                    <div class="param-row">
                        <label for="alpha">Alpha (learning rate): <span id="alpha-val">0.1</span></label>
                        <input type="range" id="alpha" min="0.01" max="1" step="0.01" value="0.1">
                        <span class="param-tooltip">Step size for value updates</span>
                    </div>

                    <div class="param-row">
                        <label for="epsilon">Epsilon (exploration): <span id="epsilon-val">0.1</span></label>
                        <input type="range" id="epsilon" min="0" max="1" step="0.01" value="0.1">
                        <span class="param-tooltip">Probability of random action</span>
                    </div>

                    <div class="param-row">
                        <label for="episodes">Episodes: <span id="episodes-val">500</span></label>
                        <input type="range" id="episodes" min="10" max="2000" step="10" value="500">
                        <span class="param-tooltip">Number of training episodes</span>
                    </div>

                    <div class="param-row">
                        <label for="n-step">N-step: <span id="n-step-val">4</span></label>
                        <input type="range" id="n-step" min="1" max="16" step="1" value="4">
                        <span class="param-tooltip">Steps for n-step TD</span>
                    </div>
                </div>

                <div class="section">
                    <h3>Actions</h3>
                    <button id="train-btn" class="btn btn-primary">Train Agent</button>
                    <button id="run-btn" class="btn">Run Episode</button>
                    <button id="reset-btn" class="btn">Reset</button>

                    <div id="training-status" style="display: none;">
                        <div class="status-message"></div>
                        <div class="progress-bar-container">
                            <div class="progress-bar"></div>
                            <div class="progress-text">0%</div>
                        </div>
                        <div class="training-details">
                            <div>Episode: <span id="current-episode">0</span> / <span id="total-episodes">0</span></div>
                            <div>Convergence: <span id="convergence-val">-</span></div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Manual Control</h3>
                    <div class="arrow-keys">
                        <button id="up-btn" class="arrow-btn">↑</button>
                        <div class="arrow-row">
                            <button id="left-btn" class="arrow-btn">←</button>
                            <button id="down-btn" class="arrow-btn">↓</button>
                            <button id="right-btn" class="arrow-btn">→</button>
                        </div>
                    </div>
                    <p class="tooltip">Use arrows or keyboard to control agent</p>
                </div>
            </div>

            <!-- Middle Panel - Visualization -->
            <div class="viz-panel">
                <div class="section">
                    <h3>Environment View</h3>
                    <div id="env-canvas-container">
                        <canvas id="env-canvas" width="400" height="400"></canvas>
                    </div>
                    <div id="state-info">
                        <span>State: <span id="current-state">-</span></span>
                        <span>Reward: <span id="current-reward">-</span></span>
                        <span>Done: <span id="is-done">-</span></span>
                    </div>
                    <div id="episode-info" style="display: none;">
                        <div class="episode-stats">
                            <div>Step: <span id="episode-step">0</span></div>
                            <div>Action: <span id="episode-action">-</span></div>
                            <div>Total Reward: <span id="episode-total-reward">0</span></div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Value Function</h3>
                    <div id="value-canvas-container">
                        <canvas id="value-canvas" width="400" height="400"></canvas>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Stats and Info -->
            <div class="info-panel">
                <div class="section">
                    <h3>Training Progress</h3>
                    <canvas id="chart-canvas" width="350" height="200"></canvas>
                </div>

                <div class="section">
                    <h3>Policy</h3>
                    <div id="policy-display"></div>
                </div>

                <div class="section">
                    <h3>Algorithm Info</h3>
                    <div id="algo-info">
                        <p id="algo-description">Select an algorithm to see its description</p>
                    </div>
                </div>

                <div class="section">
                    <h3>Stats</h3>
                    <div id="stats">
                        <p>Training time: <span id="train-time">-</span></p>
                        <p>Iterations: <span id="iterations">-</span></p>
                        <p>Avg reward: <span id="avg-reward">-</span></p>
                    </div>
                </div>

                <div class="section">
                    <h3>Event Log</h3>
                    <div id="log-panel"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
